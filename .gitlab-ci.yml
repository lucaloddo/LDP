stages:
  - unit-test
  - integration-test
  - sonarcloud-check
  - pages

variables:
  SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
  GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task

unit-test:
  stage: unit-test
  image: maven:3-openjdk-17
  script:
    - mvn test -PunitTests
  only:
    - main
    - sprint_2

integration-test:
  stage: integration-test
  image: maven:3-openjdk-17
  script:
    - mvn test -PintegrationTests
  only:
    - main
    - sprint_2

sonarcloud-check:
  stage: sonarcloud-check
  image: maven:3-openjdk-17
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script:
      - mvn verify sonar:sonar -Dsonar.projectKey=easydefence_easydefence -P=skipSystemTests
  only:
    - merge_requests
    - main
    - sprint_2

pages:
  stage: pages
  script:
    - echo 'Nothing to do'
  artifacts:
    paths:
      - public
  only:
    - main
    - sprint_2