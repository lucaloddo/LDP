<!DOCTYPE HTML>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ED - File Checker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel='stylesheet' href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/style.css}"/>
</head>
<body style="background-color: #FFFF;">
<div th:insert="navbar :: navbar"></div>
<div class="container vh-200">
    <h3 class="display-2 fw-italic text-center text-primary">ANALISI DEL FILE</h3>

    <div th:if="${fileDTO == null}">
        <div class="text-center">
            <h2 class="display-3 fw-bold text-success">File probabilmente innuocuo!</h2>
            <p class="fs-3"> <span class="text-success">Attenzione!</span> Il file caricato non Ã¨ stato analizzato da nessun vendor anti-malware presente nella nostra piattaforma</p>
            <p class="lead">
                Torna alla homepage per caricarne un altro!
                Oppure controlla su altre suite di security il tuo file, ad esempio visita: <br>
                <a href="https://www.virustotal.com/gui/home/upload">VirusTotal</a> oppure <a href="https://otx.alienvault.com/submissions/list">OtxAlienVault</a>
            </p>
        </div>
    </div>

    <div th:unless="${fileDTO == null}">
        <!-- pie chart -->
        <div class="row text-center">
            <div class="col-md-6 mx-auto">
                <div th:if="${fileDTO.getVotes().getHarmless() != 0} or ${fileDTO.getVotes().getMalicious() != 0}">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title"><span>Analisi dei principali anti-malware</span></h5>
                            <div class="chart">
                                <canvas id="canvas"></canvas>
                                <span th:text="${fileDTO.getVotes().getMalicious()}" id="malicious-level"
                                      style="display: none;"/>
                                <span th:text="${fileDTO.getVotes().getHarmless()}" id="harmless-level"
                                      style="display: none;"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- distribuzioni -->
        <div class="row text-center" style="padding-top: 5%;">
            <div class="col-md-6 mx-auto">
                <div class="accordion" id="accordionContainerDistributions">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="distHeading">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    aria-expanded="false"
                                    data-bs-target="#distCollapse" aria-controls="distCollapse">Distribuzioni
                            </button>
                        </h2>
                        <div id="distCollapse" aria-labelledby="distHeading" class="accordion-collapse collapse"
                             data-bs-parent="#accordionContainerDistributions">
                            <div class="accordion-body">
                                <ul class="list-group" th:each="dist: ${fileDTO.getFilenameDistributions()}">
                                    <li class="list-group-item"><span th:text="${dist}"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- tags -->
        <div class="row text-center" style="padding-top: 5%;">
            <div class="col-md-6 mx-auto">
                <div class="accordion" id="accordionContainerTags">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="tagHeading">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    aria-expanded="false"
                                    data-bs-target="#tagCollapse" aria-controls="tagCollapse">Tags
                            </button>
                        </h2>
                        <div id="tagCollapse" aria-labelledby="tagHeading" class="accordion-collapse collapse"
                             data-bs-parent="#accordionContainerTags">
                            <div class="accordion-body">
                                <ul class="list-group" th:each="tag: ${fileDTO.getTags()}">
                                    <li class="list-group-item"><span th:text="${tag}"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- bar chart -->
        <div class="row text-center" style="padding-top: 5%;">
            <div class="col-md-6 mx-auto">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title"><span>Statistiche</span></h5>
                        <div class="chart">
                            <canvas id="canvasStats"></canvas>
                            <span th:text="${fileDTO.getAnalysisStats().getHarmless()}" id="harmless-stat"
                                  style="display: none;"/>
                            <span th:text="${fileDTO.getAnalysisStats().getTypeUnsupported()}"
                                  id="type-unsupported-stat" style="display: none;"/>
                            <span th:text="${fileDTO.getAnalysisStats().getSuspicious()}" id="suspicious-stat"
                                  style="display: none;"/>
                            <span th:text="${fileDTO.getAnalysisStats().getConfirmedTimeout()}"
                                  id="confirmed-timeout-stat" style="display: none;"/>
                            <span th:text="${fileDTO.getAnalysisStats().getTimeout()}" id="timeout-stat"
                                  style="display: none;"/>
                            <span th:text="${fileDTO.getAnalysisStats().getFailure()}" id="failure-stat"
                                  style="display: none;"/>
                            <span th:text="${fileDTO.getAnalysisStats().getMalicious()}" id="malicious-stat"
                                  style="display: none;"/>
                            <span th:text="${fileDTO.getAnalysisStats().getUndetected()}" id="undetected-stat"
                                  style="display: none;"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- tattiche mitre -->
        <div class="row" style="padding-top: 5%; padding-bottom: 5%;">
            <div id="hideDiv" th:if="${fileDTO.getZenbox() != null}">
                <div class="col-md-6 mx-auto">
                    <div class="card" style="margin-top: 5%;">
                        <div class="card-body">
                            <h5 class="card-title"><span>Tattiche Mitre</span></h5>
                            <div class="accordion" id="accordionContainerMitre">
                                <div class="accordion-item" th:each="tactic: ${fileDTO.getZenbox().getTactics()}">
                                    <h2 class="accordion-header" th:attr="id='tacticHeading'+${tacticStat.index}">
                                        <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse"
                                                aria-expanded="false"
                                                th:attr="data-bs-target='#tacticCollapse'+${tacticStat.index}, aria-controls='tacticCollapse'+${tacticStat.index}">
                                            <span th:text="${tactic.getName()}"></span>
                                        </button>
                                    </h2>
                                    <div th:attr="id='tacticCollapse'+${tacticStat.index}, aria-labelledby='tacticHeading'+${tacticStat.index}"
                                         class="accordion-collapse collapse" data-bs-parent="#accordionContainerMitre">
                                        <div class="accordion-body">
                                            <b>Descrizione: </b><span th:text="${tactic.getDescription()}"/>

                                            <div class="card" style="margin-top: 5%;">
                                                <div class="card-body">
                                                    <h5 class="card-title"><span>Tecniche</span></h5>
                                                    <div class="accordion"
                                                         th:attr="id='accordionContainerTecniche'+${tacticStat.index}">
                                                        <div class="accordion-item"
                                                             th:each="tecnica: ${tactic.getTechniques()}">
                                                            <h2 class="accordion-header"
                                                                th:attr="id='tecnicaHeading'+${tacticStat.index}+${tecnicaStat.index}">
                                                                <button class="accordion-button collapsed" type="button"
                                                                        data-bs-toggle="collapse" aria-expanded="false"
                                                                        th:attr="data-bs-target='#tecnicaCollapse'+${tacticStat.index}+${tecnicaStat.index}, aria-controls='tecnicaCollapse'+${tacticStat.index}+${tecnicaStat.index}">
                                                                    <span th:text="${tecnica.getName()}"></span>
                                                                </button>
                                                            </h2>
                                                            <div class="accordion-collapse collapse"
                                                                 th:attr="id='tecnicaCollapse'+${tacticStat.index}+${tecnicaStat.index}, aria-labelledby='tecnicaHeading'+${tacticStat.index}+${tecnicaStat.index}, data-bs-parent='#accordionContainerTecniche'+${tacticStat.index}">
                                                                <div class="accordion-body">
                                                                    <b>Descrizione: </b><span
                                                                        th:text="${tecnica.getDescription()}"/>
                                                                    <div th:each="signature: ${tecnica.getSignatures()}">
                                                                        <b>Severity: </b><span
                                                                            th:text="${signature.getSeverity()}"/>
                                                                    </div>
                                                                    <b>Ulteriori informazioni: </b><a
                                                                        th:href="${tecnica.getLink()}"
                                                                        th:text="${tecnica.getLink()}"></a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"
        integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"
        integrity="sha384-hjtEWSfxVipaKknyGUhJZbhSbbepyHXBQlM78R56XnihJKl1YPeepRjUWc3aMMHH"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script type="text/javascript" th:src="@{/js/fileScript.js}"></script>
<script>
    const items = document.querySelectorAll('.nav-link');
    items.forEach(navItem => {
        navItem.classList.remove('active');
    });
    document.querySelector('#navItemFile').classList.add('active');
</script>
</html>